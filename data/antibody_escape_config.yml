# Configurations for determining effects of mutations on assays such as antibody
# escape, ACE2 binding from soluble ACE2 neutralization, etc.
# Note that in the configuration for individual selections, "antibody" is used
# as a synonym for any treatment (ACE2, heat, etc), and "no-antibody" is
# used as a synonym for the untreated conditions.

# --------------------------------------------------------------------------------------
# Define the selections
# --------------------------------------------------------------------------------------

# `assays` is keyed by assay (eg, "antibody_escape", "ACE2_binding", etc). Values are:
#    - `title`: title used for selection in docs
#    - `selections`: name of key used to define all selections for this assay
#    - `averages`: name of key used to define averages across selections for this assay.
#       Leave out this key if not taking averages.
#    - `prob_escape_scale`: the scale used for the y-axis when plotting prob escape as
#      a function of concentration. Typically symlog if all values close to zero, linear
#      otherwise. Should be in the form of keyword arguments to `altair.Scale`.
#    - `scale_stat`: scale the statistic being estimated for mutation effects by this
#      number. Typically is 1 (no scaling) unless you want negative values to indicate a
#      favorable effect (as for soluble ACE2 selections), in which case use -1.
#    - `stat_name`: name assigned to statistic, eg, "escape" or "ACE2 binding".

assays:
  antibody_escape:
    title: Antibody/serum escape
    selections: antibody_selections
    averages: avg_antibody_escape
    prob_escape_scale:
      type: symlog
      constant: 0.04
    scale_stat: 1
    stat_name: escape
  ACE2_binding:
    title: ACE2 binding
    selections: ACE2_binding_selections
    averages: avg_ACE2_binding
    prob_escape_scale:
      type: linear
    scale_stat: -1
    stat_name: ACE2 binding


# --------------------------------------------------------------------------------------
# Configuration for each antibody or soluble ACE2 selection experiment.
# --------------------------------------------------------------------------------------

# `antibody_selections` is keyed by name of each selection experiment, which includes a
# no-antibody control samples and one or more antibody samples. These should typically
# be from the same library and run on same date. Selection experiments are recommended
# to be named as <Library>-<date as YYMMDD>-<description (eg, antibody)>-<replicate>.
# Each selection experiment should in turn provide the following keys:
#  - `neut_standard_name`: name of neutralization standard in `neut_standard_barcodes`
#  - `no_antibody_sample`: name of the no-antibody sample
#  - `antibody_samples`: a dict keyed by sample name with values of:
#    * `concentration`: the concentration of the antibody
#    * `use_in_fit`: whether to use this sample in the `polyclonal` fit
#  - `prob_escape_filters`: dict giving filters of prob_escape values to use for fitting
#  - `polyclonal_params`: dict giving parameters for `polyclonal` model fitting.
#  - `escape_plot_kwargs`: dict giving parameters for `polyclonal` escape plot
#  - `plot_hide_stats`: dict giving data frames with stats for slider to hide mutations
# The `use_in_fit` option exists because you may decide that some samples are outside
# the preferred neutralization range to include in the fit, so if `use_in_fit: false`
# then functional scores are computed and plotted but it is not included in the fit.

# default prob_escape filters
prob_escape_filters_default: &prob_escape_filters_default
  # error if sample used in fit doesn't have >= this many neut standard counts and
  # >= this fraction of all counts from neut standard.
  min_neut_standard_count: 1000
  min_neut_standard_frac: 0.0001
  # Only retain for fitting variants with at least this many counts and this fraction
  # of total counts in the no-antibody sample **OR** the indicated counts and fraction
  # of total counts in the antibody sample.
  min_no_antibody_count: 20  # make bigger for real experiments, say 20
  min_no_antibody_frac: 0.000001  # make smaller for large libraries, say ~0.1 / (library size)
  min_antibody_count: 100  # make bigger for real experiments, say 100
  min_antibody_frac: 0.0001  # make smaller for large libraries, say ~10 / (library size)
  # For averaging and plotting the mean probability (fraction) escape across variants, use
  # these cutoffs:
  max_aa_subs: 3  # group variants with >= this many substitutions
  clip_uncensored_prob_escape: 5  # clip uncensored prob escape values at this max

# default parameters for `polyclonal` model fitting
polyclonal_params_default: &polyclonal_params_default
  n_epitopes: 1  # fit this many epitopes, also fit all numbers less than this and plot
  spatial_distances: null
  fit_kwargs:  # keyword arguments to `Polyclonal.fit`
    reg_escape_weight: 0.1
    reg_spread_weight: 0.25
    reg_activity_weight: 1.0
    logfreq: 200

# keyword arguments to `Polyclonal.mut_escape_plot`
escape_plot_kwargs_default: &escape_plot_kwargs_default
  addtl_slider_stats:
    times_seen: 3
  addtl_tooltip_stats:
    - sequential_site
  heatmap_max_at_least: 2
  heatmap_min_at_least: -4
  init_floor_at_zero: false
  init_site_statistic: sum
  site_zoom_bar_color_col: region  # supplied in `site_numbering_map`


# Specify any statistics (usually functional effects) for which you want to enable
# sliders that hide data. Keyed by statistic name, then next dict gives:
#   - `csv`: CSV file with the data, should have columns "site" and "mutant"
#   - `csv_col`: column in the CSV with the data
#   - `init`: initial value of slider
plot_hide_stats_default: &plot_hide_stats_default
  functional effect:
    csv: results/func_effects/averages/293T_high_ACE2_entry_func_effects.csv
    csv_col: effect
    init: -2
    min_filters:
      times_seen: 3
  ACE2 binding:
    csv: results/ACE2_binding/averages/monomeric_ACE2_mut_effect.csv
    csv_col: ACE2 binding_mean
    init: -3
    min_filters:
      times_seen: 3

# define the antibody selections
antibody_selections:
# --------------------------------------------------------------------------------------
  Lib1-240321-399:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240321-no-antibody_control
    #concentration in ug/ml
    antibody_samples:
     Lib1-240321-399_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib1-240321-399_0.33:
      concentration: 0.33
      use_in_fit: true
     Lib1-240321-399_0.40:
      concentration: 0.4
      use_in_fit: true
  Lib2-240321-399:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240321-no-antibody_control
    #concentration in ug/ml
    antibody_samples:
     Lib2-240321-399_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib2-240321-399_0.33:
      concentration: 0.33
      use_in_fit: true
     Lib2-240321-399_0.40:
      concentration: 0.4
      use_in_fit: true

  Lib1-240321-400:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240321-no-antibody_control
    #concentration in ug/ml
    antibody_samples:
     Lib1-240321-400_0.19:
      concentration: 0.19
      use_in_fit: true
     Lib1-240321-400_0.33:
      concentration: 0.33
      use_in_fit: true
     Lib1-240321-400_0.40:
      concentration: 0.4
      use_in_fit: true
  Lib2-240321-400:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240321-no-antibody_control
    #concentration in ug/ml
    antibody_samples:
     Lib2-240321-400_0.19:
      concentration: 0.25
      use_in_fit: true
     Lib2-240321-400_0.33:
      concentration: 0.33
      use_in_fit: true
     Lib2-240321-400_0.40:
      concentration: 0.4
      use_in_fit: true


  Lib1-240801-infant-1-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240801-no-antibody_control
    antibody_samples:
     Lib1-240801-infant-1-born2022_exposure1_0.037:
      concentration: 0.037
      use_in_fit: False
     Lib1-240801-infant-1-born2022_exposure1_0.111:
      concentration: 0.111
      use_in_fit: true
     Lib1-240801-infant-1-born2022_exposure1_0.304:
      concentration: 0.304
      use_in_fit: true

  Lib2-240801-infant-1-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240801-no-antibody_control
    antibody_samples:
     Lib2-240801-infant-1-born2022_exposure1_0.037:
      concentration: 0.037
      use_in_fit: False
     Lib2-240801-infant-1-born2022_exposure1_0.111:
      concentration: 0.111
      use_in_fit: true
     Lib2-240801-infant-1-born2022_exposure1_0.304:
      concentration: 0.304
      use_in_fit: true

  
  Lib1-240801-infant-2-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240801-no-antibody_control
    antibody_samples:
     Lib1-240801-infant-2-born2022_exposure1_0.016:
      concentration: 0.016
      use_in_fit: False
     Lib1-240801-infant-2-born2022_exposure1_0.048:
      concentration: 0.048
      use_in_fit: true
     Lib1-240801-infant-2-born2022_exposure1_0.16:
      concentration: 0.16
      use_in_fit: true
  Lib2-240801-infant-2-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240801-no-antibody_control
    antibody_samples:
     Lib2-240801-infant-2-born2022_exposure1_0.016:
      concentration: 0.016
      use_in_fit: False
     Lib2-240801-infant-2-born2022_exposure1_0.048:
      concentration: 0.048
      use_in_fit: true
     Lib2-240801-infant-2-born2022_exposure1_0.16:
      concentration: 0.16
      use_in_fit: true


  Lib1-240801-infant-3-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240801-no-antibody_control
    antibody_samples:
     Lib1-240801-infant-3-born2022_exposure1_0.041:
      concentration: 0.041
      use_in_fit: False
     Lib1-240801-infant-3-born2022_exposure1_0.134:
      concentration: 0.134
      use_in_fit: true
     Lib1-240801-infant-3-born2022_exposure1_0.533:
      concentration: 0.533
      use_in_fit: true
  Lib2-240801-infant-3-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240801-no-antibody_control
    antibody_samples:
     Lib2-240801-infant-3-born2022_exposure1_0.041:
      concentration: 0.041
      use_in_fit: False
     Lib2-240801-infant-3-born2022_exposure1_0.134:
      concentration: 0.134
      use_in_fit: true
     Lib2-240801-infant-3-born2022_exposure1_0.533:
      concentration: 0.533
      use_in_fit: true


  Lib1-240903-infant-4-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240903-no-antibody_control
    antibody_samples:
     Lib1-240903-infant-4-born2022_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib1-240903-infant-4-born2022_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true
  Lib2-240903-infant-4-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240903-no-antibody_control
    antibody_samples:
     Lib2-240903-infant-4-born2022_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib2-240903-infant-4-born2022_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true

  Lib1-240903-infant-5-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240903-no-antibody_control
    antibody_samples:
     Lib1-240903-infant-5-born2022_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib1-240903-infant-5-born2022_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true
  Lib2-240903-infant-5-born2022_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240903-no-antibody_control
    antibody_samples:
     Lib2-240903-infant-5-born2022_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib2-240903-infant-5-born2022_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true


  Lib1-240903-infant-5-born2022_exposure2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240903-no-antibody_control
    antibody_samples:
     Lib1-240903-infant-5-born2022_exposure2-0.003:
      concentration: 0.003
      use_in_fit: true
     Lib1-240903-infant-5-born2022_exposure2-0.012:
      concentration: 0.012
      use_in_fit: true
     Lib1-240903-infant-5-born2022_exposure2-0.05:
      concentration: 0.05
      use_in_fit: true
  Lib2-240903-infant-5-born2022_exposure2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240903-no-antibody_control
    antibody_samples:
     Lib2-240903-infant-5-born2022_exposure2-0.003:
      concentration: 0.003
      use_in_fit: true
     Lib2-240903-infant-5-born2022_exposure2-0.012:
      concentration: 0.012
      use_in_fit: true
     Lib2-240903-infant-5-born2022_exposure2-0.05:
      concentration: 0.05
      use_in_fit: true


  Lib1-240903-infant-6-born2023_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240903-no-antibody_control
    antibody_samples:
     Lib1-240903-infant-6-born2023_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib1-240903-infant-6-born2023_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true
  Lib2-240903-infant-6-born2023_exposure1:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240903-no-antibody_control
    antibody_samples:
     Lib2-240903-infant-6-born2023_exposure1-0.429:
      concentration: 0.429
      use_in_fit: true
     Lib2-240903-infant-6-born2023_exposure1-1.125:
      concentration: 1.125
      use_in_fit: true

  Lib1-240903-infant-6-born2023_exposure2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-240903-no-antibody_control
    antibody_samples:
     Lib1-240903-infant-6-born2023_exposure2-0.006:
      concentration: 0.006
      use_in_fit: true
     Lib1-240903-infant-6-born2023_exposure2-0.024:
      concentration: 0.024
      use_in_fit: true
     Lib1-240903-infant-6-born2023_exposure2-0.102:
      concentration: 0.102
      use_in_fit: true
  Lib2-240903-infant-6-born2023_exposure2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-240903-no-antibody_control
    antibody_samples:
     Lib2-240903-infant-6-born2023_exposure2-0.006:
      concentration: 0.006
      use_in_fit: true
     Lib2-240903-infant-6-born2023_exposure2-0.024:
      concentration: 0.024
      use_in_fit: true
     Lib2-240903-infant-6-born2023_exposure2-0.102:
      concentration: 0.102
      use_in_fit: true


  Lib1-241004-child-1-born2020:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241004-no-antibody_control
    antibody_samples:
     Lib1-241004-child-1-born2020_0.021:
      concentration: 0.021
      use_in_fit: true
     Lib1-241004-child-1-born2020_0.09:
      concentration: 0.09
      use_in_fit: true
     Lib1-241004-child-1-born2020_0.411:
      concentration: 0.411
      use_in_fit: true
  Lib2-241004-child-1-born2020:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241004-no-antibody_control
    antibody_samples:
     Lib2-241004-child-1-born2020_0.021:
      concentration: 0.021
      use_in_fit: true
     Lib2-241004-child-1-born2020_0.09:
      concentration: 0.09
      use_in_fit: true
     Lib2-241004-child-1-born2020_0.411:
      concentration: 0.411
      use_in_fit: true


  Lib1-241004-child-2-born2021:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241004-no-antibody_control
    antibody_samples:
     Lib1-241004-child-2-born2021_0.053:
      concentration: 0.053
      use_in_fit: true
     Lib1-241004-child-2-born2021_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib1-241004-child-2-born2021_1.333:
      concentration: 1.333
      use_in_fit: true
  Lib2-241004-child-2-born2021:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241004-no-antibody_control
    antibody_samples:
     Lib2-241004-child-2-born2021_0.053:
      concentration: 0.053
      use_in_fit: true
     Lib2-241004-child-2-born2021_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib2-241004-child-2-born2021_1.333:
      concentration: 1.333
      use_in_fit: true


  Lib1-241004-child-3-born2021:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241004-no-antibody_control
    antibody_samples:
     Lib1-241004-child-3-born2021_0.053:
      concentration: 0.053
      use_in_fit: true
     Lib1-241004-child-3-born2021_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib1-241004-child-3-born2021_1.333:
      concentration: 1.333
      use_in_fit: true
  Lib2-241004-child-3-born2021:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241004-no-antibody_control
    antibody_samples:
     Lib2-241004-child-3-born2021_0.053:
      concentration: 0.053
      use_in_fit: true
     Lib2-241004-child-3-born2021_0.25:
      concentration: 0.25
      use_in_fit: true
     Lib2-241004-child-3-born2021_1.333:
      concentration: 1.333
      use_in_fit: true





# --------------------------------------------------------------------------------------


# Note that for soluble receptor affinity selections, you define selection experiments
# exactly analogously to `antibody_selections` in `receptor_selections`, using `antibody`
# as a synonym for the soluble receptor.

# Define some defaults slightly different than from antibody selections

# default parameters for `polyclonal` model fitting for receptor affinity
ACE2_binding_polyclonal_params_default: &ACE2_binding_polyclonal_params_default
  n_epitopes: 1
  spatial_distances: null
  fit_kwargs:  # keyword arguments to `Polyclonal.fit`
    reg_escape_weight: 0.1
    reg_spread_weight: 0
    reg_activity_weight: 1.0
    logfreq: 200

# default stats to hide cells on plot of receptor affinity
ACE2_binding_plot_hide_stats_default: &ACE2_binding_plot_hide_stats_default
  functional effect:
    csv: results/func_effects/averages/293T_high_ACE2_entry_func_effects.csv
    csv_col: effect
    init: -1.5
    min_filters:
      times_seen: 3

# Define the receptor selections
ACE2_binding_selections:
  Lib1-230614-monomeric_ACE2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *ACE2_binding_polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *ACE2_binding_plot_hide_stats_default
    no_antibody_sample: Lib1-230614-no-antibody_control_mediumACE2
    antibody_samples:
      Lib1-230614-monomeric_ACE2_2.88:
        concentration: 2.88
        use_in_fit: true
      Lib1-230614-monomeric_ACE2_8.63:
        concentration: 8.63
        use_in_fit: true
      Lib1-230614-monomeric_ACE2_25.9:
        concentration: 25.9
        use_in_fit: true
      Lib1-230614-monomeric_ACE2_77.7:
        concentration: 77.7
        use_in_fit: true
      Lib1-230614-monomeric_ACE2_233:
        concentration: 233
        use_in_fit: true
  Lib2-230614-monomeric_ACE2:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *ACE2_binding_polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *ACE2_binding_plot_hide_stats_default
    no_antibody_sample: Lib2-230614-no-antibody_control_mediumACE2
    antibody_samples:
      Lib2-230614-monomeric_ACE2_2.88:
        concentration: 2.88
        use_in_fit: true
      Lib2-230614-monomeric_ACE2_8.63:
        concentration: 8.63
        use_in_fit: true
      Lib2-230614-monomeric_ACE2_25.9:
        concentration: 25.9
        use_in_fit: true
      Lib2-230614-monomeric_ACE2_77.7:
        concentration: 77.7
        use_in_fit: true
      Lib2-230614-monomeric_ACE2_233:
        concentration: 233
        use_in_fit: true

# --------------------------------------------------------------------------------------
# Configuration for averaging/plotting selections for same antibody or soluble ACE2
# --------------------------------------------------------------------------------------

# Average/plot escape values from different selections with the same antibody/serum using
# `avg_antibody_escape`. Each key is the name of an antibody/serum that has the following values:
#   - `selections`: list of antibody selections for which we average escape
#   - `icXX`: for the plot showing fold-change in ICXX (eg, IC90), what is XX (eg, 90)
#   - `escape_plot_kwargs`: keyword arguments for `PolyclonalAverage.mut_escape_plot`
#   - `plot_hide_stats`: dict giving data frames with stats for slider to hide mutations
#   - `title`: title of plots

# For soluble ACE2 experiments used to measure ACE2 binding, do exactly the same
# except under the key `avg_ACE2_binding` rather than `avg_antibody_escape`.

# Define defaults for each antibody/serum, used via the merge (<<) operator
avg_antibody_escape_default: &avg_antibody_escape_default
  icXX: 50
  show_icXX_in_docs: true
  escape_plot_kwargs:
    <<: *escape_plot_kwargs_default
    avg_type: median
    addtl_slider_stats:
      times_seen: 3
      escape_std: 1.5
    addtl_slider_stats_as_max: [escape_std]
    per_model_tooltip: true
  plot_hide_stats: *plot_hide_stats_default

# Define the antibodies/sera to average
avg_antibody_escape:
  sera-3990519:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240321-399
      - Lib2-240321-399

  sera-4002223:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240321-400
      - Lib2-240321-400

  sera-infant-1-born2022_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240801-infant-1-born2022_exposure1
      - Lib2-240801-infant-1-born2022_exposure1

  sera-infant-2-born2022_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240801-infant-2-born2022_exposure1
      - Lib2-240801-infant-2-born2022_exposure1

  sera-infant-3-born2022_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240801-infant-3-born2022_exposure1
      - Lib2-240801-infant-3-born2022_exposure1

  sera-infant-4-born2022_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240903-infant-4-born2022_exposure1
      - Lib2-240903-infant-4-born2022_exposure1

  sera-infant-5-born2022_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240903-infant-5-born2022_exposure1
      - Lib2-240903-infant-5-born2022_exposure1

  sera-infant-5-born2022_exposure2:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240903-infant-5-born2022_exposure2
      - Lib2-240903-infant-5-born2022_exposure2

  sera-infant-6-born2023_exposure1:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240903-infant-6-born2023_exposure1
      - Lib2-240903-infant-6-born2023_exposure1

  sera-infant-6-born2023_exposure2:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-240903-infant-6-born2023_exposure2
      - Lib2-240903-infant-6-born2023_exposure2

  sera-child-1-born2020:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241004-child-1-born2020
      - Lib2-241004-child-1-born2020

  sera-child-2-born2021:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241004-child-2-born2021
      - Lib2-241004-child-2-born2021
 
  sera-child-3-born2021:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241004-child-3-born2021
      - Lib2-241004-child-3-born2021



# Define the receptor affinity experiments to average
avg_ACE2_binding_default: &avg_ACE2_binding_default
  <<: *avg_antibody_escape_default
  escape_plot_kwargs:
    <<: *escape_plot_kwargs_default
    avg_type: median
    addtl_slider_stats:
      times_seen: 3
      escape_std: 3
    addtl_slider_stats_as_max: [escape_std]
    per_model_tooltip: true
  icXX: 50  # IC50

avg_ACE2_binding:
  monomeric_ACE2:
    <<: *avg_ACE2_binding_default
    plot_hide_stats: *ACE2_binding_plot_hide_stats_default
    selections:
      - Lib1-230614-monomeric_ACE2
      - Lib2-230614-monomeric_ACE2
